@model DeliveryDost.Web.ViewModels.Business.SubscriptionViewModel?

<div class="page-header">
    <h1 class="page-title">My Subscription</h1>
    <p class="page-subtitle">Manage your subscription and billing</p>
</div>

@if (Model == null)
{
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="bi bi-star display-1 text-muted mb-3"></i>
                    <h4>No Active Subscription</h4>
                    <p class="text-muted mb-4">
                        You don't have an active subscription. Subscribe to a plan to unlock premium features,
                        get discounts on deliveries, and access priority support.
                    </p>
                    <a asp-action="Index" class="btn btn-primary">
                        <i class="bi bi-star me-1"></i> View Subscription Plans
                    </a>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="row g-4">
        <div class="col-lg-8">
            <!-- Current Plan -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-star-fill text-warning me-2"></i>Current Plan</span>
                    <span class="badge @Model.StatusBadgeClass">@Model.StatusText</span>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h3 class="mb-1">@Model.PlanName</h3>
                            <p class="text-muted mb-0">
                                @Model.BillingCycle billing - &#8377;@Model.PricePerCycle.ToString("N0")/@(Model.BillingCycle == "ANNUAL" ? "year" : "month")
                            </p>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <div class="mb-2">
                                @if (Model.DaysRemaining > 0)
                                {
                                    <span class="text-muted">@Model.DaysRemaining days remaining</span>
                                }
                                else
                                {
                                    <span class="text-danger">Expired</span>
                                }
                            </div>
                            <small class="text-muted">
                                Renews on @Model.EndDate.ToString("MMM dd, yyyy")
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Usage -->
            <div class="card mb-4">
                <div class="card-header">
                    <span><i class="bi bi-graph-up me-2"></i>Usage This Month</span>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>Deliveries Used</span>
                            <span>
                                @Model.DeliveriesUsed /
                                @(Model.DeliveriesLimit < 0 ? "Unlimited" : Model.DeliveriesLimit.ToString())
                            </span>
                        </div>
                        @if (Model.DeliveriesLimit > 0)
                        {
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar @(Model.UsagePercent > 80 ? "bg-warning" : "bg-primary")"
                                     role="progressbar"
                                     style="width: @Model.UsagePercent%"
                                     aria-valuenow="@Model.UsagePercent"
                                     aria-valuemin="0"
                                     aria-valuemax="100">
                                </div>
                            </div>
                        }
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-4">
                            <div class="stat-mini text-center">
                                <h4 class="mb-0">@Model.DeliveryDiscount%</h4>
                                <small class="text-muted">Delivery Discount</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-mini text-center">
                                <h4 class="mb-0">@Model.DeliveriesUsed</h4>
                                <small class="text-muted">Deliveries Made</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-mini text-center">
                                <h4 class="mb-0">@Model.DaysRemaining</h4>
                                <small class="text-muted">Days Left</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Billing History Link -->
            <div class="card">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <i class="bi bi-receipt me-2"></i>
                        <span>View billing history and invoices</span>
                    </div>
                    <a asp-action="History" class="btn btn-outline-primary btn-sm">
                        View History
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Settings -->
            <div class="card mb-4">
                <div class="card-header">
                    <span><i class="bi bi-gear me-2"></i>Subscription Settings</span>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <strong>Auto-Renewal</strong>
                            <small class="d-block text-muted">Automatically renew subscription</small>
                        </div>
                        <form asp-action="ToggleAutoRenew" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="autoRenew" value="@(!Model.IsAutoRenew)" />
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox"
                                       @(Model.IsAutoRenew ? "checked" : "")
                                       onchange="this.form.submit()" />
                            </div>
                        </form>
                    </div>
                    <hr />
                    <div class="d-grid gap-2">
                        <a asp-action="Index" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-up-circle me-1"></i> Upgrade Plan
                        </a>
                        <form asp-action="Cancel" method="post">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-outline-danger w-100"
                                    onclick="return confirm('Are you sure you want to cancel your subscription? It will remain active until the end of the billing period.')">
                                <i class="bi bi-x-circle me-1"></i> Cancel Subscription
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Support -->
            <div class="card">
                <div class="card-header">
                    <span><i class="bi bi-headset me-2"></i>Need Help?</span>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">
                        Have questions about your subscription? Our support team is here to help.
                    </p>
                    <a asp-controller="Complaint" asp-action="Create" class="btn btn-outline-secondary w-100">
                        <i class="bi bi-chat-dots me-1"></i> Contact Support
                    </a>
                </div>
            </div>
        </div>
    </div>
}

<style>
    .stat-mini {
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 8px;
    }
</style>
