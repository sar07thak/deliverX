@model DeliveryDost.Web.ViewModels.Dp.KycStatusViewModel
@{
    ViewData["Title"] = "KYC Status";
}

<div class="page-header">
    <h1 class="page-title">KYC Verification Status</h1>
    <p class="page-subtitle">Track your verification progress</p>
</div>

<!-- Overall Status -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h4 class="mb-2">
                    @switch (Model.OverallStatus)
                    {
                        case "FULLY_VERIFIED":
                            <span class="text-success"><i class="bi bi-check-circle-fill me-2"></i>Fully Verified</span>
                            break;
                        case "PARTIALLY_VERIFIED":
                            <span class="text-warning"><i class="bi bi-clock-fill me-2"></i>Verification In Progress</span>
                            break;
                        case "REJECTED":
                            <span class="text-danger"><i class="bi bi-x-circle-fill me-2"></i>Verification Issues</span>
                            break;
                        default:
                            <span class="text-secondary"><i class="bi bi-hourglass-split me-2"></i>Pending Verification</span>
                            break;
                    }
                </h4>
                <p class="text-muted mb-0">@Model.NextStep</p>
            </div>
            <div class="col-md-4 text-end">
                @if (Model.CanActivate)
                {
                    <a asp-controller="Dashboard" asp-action="Index" class="btn btn-success btn-lg">
                        <i class="bi bi-play-circle me-2"></i>Start Earning
                    </a>
                }
                else if (Model.PendingVerifications.Contains("aadhaar"))
                {
                    <form asp-action="InitiateDigiLocker" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-shield-check me-2"></i>Verify via DigiLocker
                        </button>
                    </form>
                }
            </div>
        </div>
    </div>
</div>

<!-- Verification Items -->
<div class="row">
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h5 class="mb-1"><i class="bi bi-person-badge me-2"></i>Aadhaar</h5>
                        <small class="text-muted">Identity Verification</small>
                    </div>
                    <span class="badge @Model.AadhaarVerification.StatusBadgeClass">@Model.AadhaarVerification.Status</span>
                </div>

                @if (Model.AadhaarVerification.Status == "VERIFIED")
                {
                    <p class="mb-1 text-success"><i class="bi bi-check me-1"></i>Verified</p>
                    @if (Model.AadhaarVerification.VerifiedAt.HasValue)
                    {
                        <small class="text-muted">on @Model.AadhaarVerification.VerifiedAt.Value.ToString("dd MMM yyyy")</small>
                    }
                }
                else if (Model.AadhaarVerification.Status == "IN_PROGRESS")
                {
                    <p class="mb-1 text-info"><i class="bi bi-clock me-1"></i>Verification in progress</p>
                    <small class="text-muted">Usually takes 1-2 hours</small>
                }
                else if (Model.AadhaarVerification.Status == "REJECTED")
                {
                    <p class="mb-1 text-danger"><i class="bi bi-x me-1"></i>@(Model.AadhaarVerification.Message ?? "Verification failed")</p>
                    <a asp-action="Register" class="btn btn-sm btn-outline-primary mt-2">Re-submit</a>
                }
                else
                {
                    <p class="mb-0 text-muted">Not yet submitted</p>
                }
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h5 class="mb-1"><i class="bi bi-credit-card me-2"></i>PAN</h5>
                        <small class="text-muted">Tax Verification</small>
                    </div>
                    <span class="badge @Model.PANVerification.StatusBadgeClass">@Model.PANVerification.Status</span>
                </div>

                @if (Model.PANVerification.Status == "VERIFIED")
                {
                    <p class="mb-1 text-success"><i class="bi bi-check me-1"></i>Verified</p>
                    @if (Model.PANVerification.VerifiedAt.HasValue)
                    {
                        <small class="text-muted">on @Model.PANVerification.VerifiedAt.Value.ToString("dd MMM yyyy")</small>
                    }
                }
                else if (Model.PANVerification.Status == "IN_PROGRESS")
                {
                    <p class="mb-1 text-info"><i class="bi bi-clock me-1"></i>Verification in progress</p>
                    <small class="text-muted">Usually takes 5-10 minutes</small>
                }
                else if (Model.PANVerification.Status == "REJECTED")
                {
                    <p class="mb-1 text-danger"><i class="bi bi-x me-1"></i>@(Model.PANVerification.Message ?? "Verification failed")</p>
                    <a asp-action="Register" class="btn btn-sm btn-outline-primary mt-2">Re-submit</a>
                }
                else
                {
                    <p class="mb-0 text-muted">Not yet submitted</p>
                }
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h5 class="mb-1"><i class="bi bi-bank me-2"></i>Bank Account</h5>
                        <small class="text-muted">Payout Verification</small>
                    </div>
                    <span class="badge @Model.BankVerification.StatusBadgeClass">@Model.BankVerification.Status</span>
                </div>

                @if (Model.BankVerification.Status == "VERIFIED")
                {
                    <p class="mb-1 text-success"><i class="bi bi-check me-1"></i>Verified</p>
                    @if (Model.BankVerification.VerifiedAt.HasValue)
                    {
                        <small class="text-muted">on @Model.BankVerification.VerifiedAt.Value.ToString("dd MMM yyyy")</small>
                    }
                }
                else if (Model.BankVerification.Status == "IN_PROGRESS")
                {
                    <p class="mb-1 text-info"><i class="bi bi-clock me-1"></i>Penny drop in progress</p>
                    <small class="text-muted">Usually takes 24-48 hours</small>
                }
                else if (Model.BankVerification.Status == "REJECTED")
                {
                    <p class="mb-1 text-danger"><i class="bi bi-x me-1"></i>@(Model.BankVerification.Message ?? "Verification failed")</p>
                    <a asp-action="Register" class="btn btn-sm btn-outline-primary mt-2">Re-submit</a>
                }
                else
                {
                    <p class="mb-0 text-muted">Not yet submitted</p>
                }
            </div>
        </div>
    </div>
</div>

@if (Model.PoliceVerification != null)
{
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h5 class="mb-1"><i class="bi bi-shield me-2"></i>Police Verification</h5>
                            <small class="text-muted">Background Check</small>
                        </div>
                        <span class="badge @Model.PoliceVerification.StatusBadgeClass">@Model.PoliceVerification.Status</span>
                    </div>
                    <p class="text-muted small mb-0">
                        Police verification is optional but recommended. It may take 7-15 days.
                    </p>
                </div>
            </div>
        </div>
    </div>
}

<!-- Help Section -->
<div class="card mt-4">
    <div class="card-body">
        <h5><i class="bi bi-question-circle me-2"></i>Need Help?</h5>
        <p class="text-muted">
            If your verification is taking longer than expected or you're facing issues, please contact our support team.
        </p>
        <a href="mailto:support@deliverydost.com" class="btn btn-outline-primary">
            <i class="bi bi-envelope me-1"></i> Contact Support
        </a>
    </div>
</div>
